<?xml version="1.0"?>
<project name="crazyfm" basedir="." default="package">

    <property file="build.properties"/>

    <taskdef resource="flexTasks.tasks" classpath="${FLEX_HOME}/ant/lib/flexTasks.jar" />

    <target name="package" depends="clean,core,ext-starlingApp,asdoc"/>
    <target name="core">
        <echo>-----------------------------------</echo>
        <echo>[core] Building core...</echo>
        <echo>-----------------------------------</echo>
        <ant antfile="core/build.xml" target="build_to_root" inheritAll="true">
            <property file="core/build.properties"/>
            <property name="base_module_path" value="${base_path_core}"/>
        </ant>
    </target>
    <target name="ext-starlingApp">
        <echo>-----------------------------------</echo>
        <echo>[core] Building extension starlingApp...</echo>
        <echo>-----------------------------------</echo>
        <ant antfile="extensions/starlingApp/build.xml" target="build_to_root" inheritAll="false"/>
        <property file="extensions/starlingApp/build.properties"/>
        <property name="base_module_path" value="${base_path_ext-starlingApp}"/>
    </target>
    <target name="asdoc">
        <echo>-----------------------------------</echo>
        <echo>[asdoc] Generating core ASDOC documentation...</echo>
        <echo>-----------------------------------</echo>
        <delete dir="${doc}"/>
        <mkdir dir="${doc}"/>
        <asdoc output="${doc}" dir="${FLEX_HOME}" lenient="true" failonerror="true">
            <!-- core -->
            <doc-sources path-element="core/src"/>
            <exclude-sources path-element="core/src/com/crazyfm/mvc/controller" />
            <!-- extensions -->
            <doc-sources path-element="extensions/starlingApp/src"/>
            <!-- external libs -->
            <external-library-path dir="${starling}" includes="*"/>
            <external-library-path dir="${as3-signals}" includes="*"/>
            <external-library-path dir="${FLEX_HOME}/frameworks/libs/player/20.0" includes="*"/>
        </asdoc>
    </target>
    <target name="clean">
        <echo>-----------------------------------</echo>
        <echo>[clean] Cleaning build directory...</echo>
        <echo>-----------------------------------</echo>
        <delete dir="$(out)"/>
    </target>
</project>
